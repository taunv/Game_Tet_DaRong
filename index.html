<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vui Xu√¢n ‚Äì ƒê√≥n T·∫øt ƒê√† R·ªìng | Game - Ch·∫µn ‚Äì L·∫ª</title>
  <style>
    :root{
      --red1:#7a0b0b; --red2:#b31212; --red3:#d81b1b;
      --gold1:#ffdf7a; --gold2:#ffd24d; --gold3:#ffefb6;
      --ink:#2b0a0a;
      --card: rgba(122,11,11,.55);
      --line: rgba(255,210,77,.45);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", sans-serif;
      background: radial-gradient(1200px 600px at 50% -10%, #ffefb6 0%, rgba(255,239,182,0) 55%),
                  linear-gradient(180deg, var(--red1), var(--red2) 55%, var(--red1));
      color: var(--gold3);
    }
    .wrap{ max-width: 520px; margin: 0 auto; padding: 16px; }
    .header{ display:flex; gap:12px; align-items:center; margin-bottom:12px; }
    .logo{
      width:56px; height:56px; border-radius:18px;
      background: rgba(255,210,77,.92);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden; box-shadow: 0 10px 24px rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.15);
      flex: 0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; }
    .title{ flex:1; }
    .title h1{ margin:0; font-size: 20px; line-height:1.15; }
    .title .sub{ opacity:.9; font-size: 13px; margin-top:4px; }

    .card{
      background: var(--card);
      border: 2px solid rgba(255,210,77,.65);
      border-radius: 20px;
      padding: 14px;
      box-shadow: 0 16px 40px rgba(0,0,0,.28);
      backdrop-filter: blur(6px);
    }
    .section{
      background: rgba(0,0,0,.12);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      margin-top: 10px;
    }
    .row{ display:flex; gap:10px; align-items:center; }
    .row.space{ justify-content:space-between; }
    .label{ font-weight: 650; color: var(--gold3); }
    .muted{ opacity:.88; font-size: 12px; }

    input, textarea{
      width:100%;
      border: none;
      border-radius: 14px;
      padding: 10px 12px;
      outline: none;
      background: rgba(255,239,182,.95);
      color: var(--ink);
      font-size: 14px;
    }
    textarea{ min-height: 92px; resize: vertical; }

    .btnbar{ display:flex; gap:8px; }
    button{
      border: 1px solid rgba(255,210,77,.55);
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 750;
      background: rgba(255,239,182,.14);
      color: var(--gold3);
      cursor: pointer;
      width: 100%;
    }
    button.primary{
      background: linear-gradient(180deg, rgba(255,210,77,.95), rgba(255,223,122,.95));
      color: #6b0f0f;
      border-color: rgba(255,255,255,.25);
      font-size: 16px;
    }
    button.active{
      background: rgba(255,210,77,.95);
      color: #6b0f0f;
    }
    button:disabled{ opacity:.65; cursor:not-allowed; }

    .grid3{ display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; }
    .tile{
      background: rgba(255,239,182,.95);
      color: #6b0f0f;
      border-radius: 16px;
      padding: 10px 8px;
      text-align:center;
      transform: scale(1);
      transition: transform .2s ease, opacity .2s ease;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      min-height: 70px;
      display:flex; flex-direction:column; justify-content:center;
      position: relative;
      overflow: hidden;
    }
    .tile .name{ font-weight: 900; font-size: 14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .tile .idx{
      display:inline-block;
      margin: 6px auto 0;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(107,15,15,.10);
      border: 1px solid rgba(107,15,15,.18);
      font-weight: 900;
      font-size: 12px;
      opacity:.95;
    }

    .resultBox{ text-align:center; margin-top: 10px; }
    .resultBox .big{ font-size: 22px; font-weight: 900; }
    .badge{
      display:inline-block; padding: 6px 10px; border-radius: 999px;
      background: rgba(255,210,77,.95); color: #6b0f0f; font-weight: 900;
      margin-top: 6px;
    }
    .win{ margin-top: 6px; font-weight: 800; }

    .history{ max-height: 280px; overflow:auto; padding-right: 4px; }
    .hitem{
      border: 1px solid rgba(255,210,77,.25);
      border-radius: 16px;
      padding: 10px;
      background: rgba(0,0,0,.10);
      margin-top: 8px;
    }
    .hitem .top{ display:flex; justify-content:space-between; font-size: 12px; opacity:.9; }
    .hitem .mid{ display:flex; flex-wrap:wrap; gap: 8px 12px; margin-top: 6px; font-size: 13px; }
    .hitem .mid span b{ color: var(--gold2); }
    .hitem .bot{ margin-top: 6px; font-size: 12px; opacity:.9; line-height:1.35; }

    .footerNote{ margin-top: 10px; font-size: 12px; opacity:.85; text-align:center; }

    /* ===== L√î T√î EFFECT ===== */
    .tile::before{
      content:"";
      position:absolute;
      inset:-40% -60%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent);
      transform: rotate(20deg);
      opacity: 0;
      pointer-events:none;
    }
    .tile.spinning{
      animation: lottoShake .18s infinite linear;
    }
    .tile.spinning::before{
      opacity: .35;
      animation: shine 1.1s infinite linear;
    }
    .tile.locked{
      transform: scale(1.04);
      box-shadow: 0 14px 30px rgba(0,0,0,.25);
      animation: pop .22s ease-out;
    }
    @keyframes lottoShake{
      0%{ transform: translateY(0) scale(1); }
      50%{ transform: translateY(-1px) scale(1.01); }
      100%{ transform: translateY(0) scale(1); }
    }
    @keyframes shine{
      0%{ transform: translateX(-60%) rotate(20deg); }
      100%{ transform: translateX(60%) rotate(20deg); }
    }
    @keyframes pop{
      0%{ transform: scale(0.92); }
      100%{ transform: scale(1.04); }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div class="logo" title="Logo ƒê√† R·ªìng">
        <!-- N·∫øu b·∫°n upload file logo_DaRo.ico (ho·∫∑c logo_DaRo.png) v√†o repo, n√≥ s·∫Ω t·ª± hi·ªán -->
        <img id="logoImg" src="logo_DaRo.ico" alt="Logo"
             onerror="this.style.display='none'; document.getElementById('logoFallback').style.display='block';">
        <div id="logoFallback" style="display:none; font-weight:1000; color:#6b0f0f; font-size:20px;">DR</div>
      </div>
      <div class="title">
        <h1>Vui Xu√¢n ‚Äì ƒê√≥n T·∫øt c√πng Gia ƒë√¨nh ƒê√† R·ªìng</h1>
        <div class="sub">Game x√°c su·∫•t: quay 3 nh√¢n vi√™n ‚Üí t√≠nh t·ªïng ‚Üí Ch·∫µn / L·∫ª / 0</div>
      </div>
    </div>

    <div class="card">

      <div class="section">
        <div class="row space">
          <div>
            <div class="label">S·ªë d∆∞</div>
            <div class="muted">M√¥ ph·ªèng trong game (l∆∞u tr√™n m√°y b·∫°n)</div>
          </div>
          <div class="label" id="balanceText">0 ƒë</div>
        </div>

        <div style="height:8px"></div>

        <div class="row" style="gap:8px;">
          <div style="width:110px;" class="muted">Ti·ªÅn c∆∞·ª£c</div>
          <input id="stakeInput" type="number" min="0" step="1000" />
        </div>
        <div class="muted" style="margin-top:6px;">
          Quy t·∫Øc: Tr√∫ng CH·∫¥N/L·∫∫ nh·∫≠n ƒë√∫ng ti·ªÅn c∆∞·ª£c; tr√∫ng S·ªê 0 nh·∫≠n x2.
        </div>
      </div>

      <div class="section">
        <div class="label">Ch·ªçn c·ª≠a</div>
        <div class="btnbar" style="margin-top:8px;">
          <button id="betEven" onclick="setBet('even')">Ch·∫µn</button>
          <button id="betOdd" onclick="setBet('odd')">L·∫ª</button>
          <button id="betZero" onclick="setBet('zero')">0</button>
        </div>

        <div class="row space" style="margin-top:10px;">
          <div>
            <div class="label">√Çm thanh</div>
            <div class="muted">Tr·ªëng khi quay, ph√°o khi tr√∫ng</div>
          </div>
          <button id="soundBtn" style="width:140px;" onclick="toggleSound()">B·∫≠t</button>
        </div>

        <!-- Audio (tu·ª≥ ch·ªçn). N·∫øu b·∫°n upload file v√†o ƒë√∫ng ƒë∆∞·ªùng d·∫´n, s·∫Ω ph√°t ƒë∆∞·ª£c -->
        <audio id="drumAudio" preload="auto" src="sfx/drum.mp3"></audio>
        <audio id="fireAudio" preload="auto" src="sfx/firecracker.mp3"></audio>

        <div style="height:10px"></div>
        <button class="primary" id="spinBtn" onclick="spin()">B·∫Øt ƒë·∫ßu</button>
      </div>

      <div class="section">
        <div class="label" style="text-align:center;">K·∫øt qu·∫£ quay</div>
        <div style="height:8px"></div>

        <div class="grid3" id="tiles">
          <div class="tile"><div class="name">‚Äî</div><div class="idx">‚Äî</div></div>
          <div class="tile"><div class="name">‚Äî</div><div class="idx">‚Äî</div></div>
          <div class="tile"><div class="name">‚Äî</div><div class="idx">‚Äî</div></div>
        </div>

        <div class="resultBox" id="resultBox" style="display:none;">
          <div>T·ªïng: <span class="big" id="sumText">0</span></div>
          <div><span class="badge" id="outcomeBadge">‚Äî</span></div>
          <div class="win" id="winText"></div>
        </div>
      </div>

      <div class="section">
        <div class="row space">
          <div class="label">L·ªãch s·ª≠ (t·ªëi ƒëa 30 l∆∞·ª£t)</div>
          <button style="width:140px;" onclick="resetAll()">Reset</button>
        </div>
        <div class="history" id="history"></div>
      </div>

      <div class="section">
        <div class="label">Danh s√°ch nh√¢n vi√™n (m·ªói d√≤ng 1 t√™n)</div>
        <div class="muted">B·∫°n c√≥ th·ªÉ th√™m/b·ªõt. Game t·ª± ƒë√°nh s·ªë th·ª© t·ª± t·ª´ 1‚Ä¶N theo ƒë√∫ng th·ª© t·ª± d√≤ng.</div>
        <div style="height:8px"></div>
        <textarea id="employeesArea"></textarea>
        <div style="height:8px"></div>
        <button onclick="applyEmployees()">√Åp d·ª•ng danh s√°ch</button>
      </div>

      <div class="footerNote">
        G·ª£i √Ω: mu·ªën c√≥ logo/√¢m thanh th·∫≠t ‚Üí upload <b>logo_DaRo.ico</b> (khuy·∫øn ngh·ªã PNG) v√† th∆∞ m·ª•c <b>sfx/</b> v√†o repo.
      </div>
    </div>
  </div>

<script>
  // ====== C·∫§U H√åNH M·∫∂C ƒê·ªäNH ======
  const DEFAULT_EMPLOYEES = [
    "T√†uNV","ThanhNC","H∆∞∆°ngPTT","H∆∞ngTV",
    "T√¢nNH","H√πngNQ","HoaPTT","Th√†nhPB",
    "Tu·∫•nNVA","AnHT","T√¢yƒêV","TrangƒêT"
  ];

  const LS_KEY = "darong_tet_game_v1";

  // ====== STATE ======
  let state = {
    employees: [...DEFAULT_EMPLOYEES],
    bet: "",            // even | odd | zero
    balance: 1000000,   // VND
    stake: 50000,       // VND
    soundOn: true,
    history: [],        // newest first
    spinning: false
  };

  function formatVND(n){
    n = Number(n) || 0;
    return new Intl.NumberFormat("vi-VN").format(n) + " ƒë";
  }
  function nowVN(){
    return new Date().toLocaleString("vi-VN");
  }

  function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
  function load(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      const obj = JSON.parse(raw);
      if(obj && typeof obj === "object") state = { ...state, ...obj };
    }catch(e){}
  }

  function parityText(p){
    if(p==="even") return "CH·∫¥N";
    if(p==="odd") return "L·∫∫";
    if(p==="zero") return "S·ªê 0";
    return "‚Äî";
  }

  function render(){
    document.getElementById("balanceText").textContent = formatVND(state.balance);
    document.getElementById("stakeInput").value = state.stake;

    const be = document.getElementById("betEven");
    const bo = document.getElementById("betOdd");
    const bz = document.getElementById("betZero");
    [be,bo,bz].forEach(b=>b.classList.remove("active"));
    if(state.bet === "even") be.classList.add("active");
    if(state.bet === "odd")  bo.classList.add("active");
    if(state.bet === "zero") bz.classList.add("active");

    document.getElementById("soundBtn").textContent = state.soundOn ? "B·∫≠t" : "T·∫Øt";
    document.getElementById("employeesArea").value = state.employees.join("\n");

    renderHistory();

    document.getElementById("spinBtn").disabled = state.spinning;
    document.getElementById("stakeInput").disabled = state.spinning;
    be.disabled = state.spinning; bo.disabled = state.spinning; bz.disabled = state.spinning;
  }

  function renderHistory(){
    const box = document.getElementById("history");
    box.innerHTML = "";
    if(!state.history.length){
      const d = document.createElement("div");
      d.className = "muted";
      d.textContent = "Ch∆∞a c√≥ l∆∞·ª£t quay n√†o.";
      box.appendChild(d);
      return;
    }
    state.history.forEach(h=>{
      const item = document.createElement("div");
      item.className = "hitem";

      const top = document.createElement("div");
      top.className = "top";
      top.innerHTML = `<div>${h.ts}</div><div style="font-weight:800;">${h.win ? "TR√öNG" : "TR∆Ø·ª¢T"}</div>`;

      const mid = document.createElement("div");
      mid.className = "mid";
      mid.innerHTML = `
        <span>C·ª≠a: <b>${parityText(h.bet)}</b></span>
        <span>C∆∞·ª£c: <b>${formatVND(h.stake)}</b></span>
        <span>KQ: <b>${parityText(h.outcome)}</b></span>
        <span>Th∆∞·ªüng: <b>${formatVND(h.payout)}</b></span>
      `;

      const bot = document.createElement("div");
      bot.className = "bot";
      bot.textContent = `3 NV: ${h.picked.map(p=>`${p.name}(#${p.index})`).join(" ‚Äì ")} ¬∑ T·ªïng: ${h.total}`;

      item.appendChild(top);
      item.appendChild(mid);
      item.appendChild(bot);
      box.appendChild(item);
    });
  }

  function setBet(b){ state.bet = b; save(); render(); }
  function toggleSound(){ state.soundOn = !state.soundOn; save(); render(); }

  function applyEmployees(){
    const raw = document.getElementById("employeesArea").value || "";
    const arr = raw.split("\n").map(s=>s.trim()).filter(Boolean);
    if(arr.length < 3){
      alert("Danh s√°ch ph·∫£i c√≥ √≠t nh·∫•t 3 nh√¢n vi√™n.");
      return;
    }
    state.employees = arr;
    save(); render();
  }

  function classify(total){
    const unit = ((total % 10) + 10) % 10;
    if(unit === 0) return "zero";
    return (unit % 2 === 0) ? "even" : "odd";
  }

  function pickThreeUnique(list){
    const idxs = [...list.keys()];
    for(let i=idxs.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [idxs[i], idxs[j]] = [idxs[j], idxs[i]];
    }
    return idxs.slice(0,3).map(i=>({ name:list[i], index:i+1 }));
  }

  function playAudio(id){
    if(!state.soundOn) return;
    const a = document.getElementById(id);
    if(!a) return;
    a.currentTime = 0;
    a.play().catch(()=>{});
  }

  // ===== L√î T√î UI =====
  function showSpinning(){
    const tiles = document.getElementById("tiles").children;
    for(let i=0;i<3;i++){
      tiles[i].classList.add("spinning");
      tiles[i].classList.remove("locked");
      tiles[i].style.opacity = "1";
      tiles[i].querySelector(".name").textContent = "ƒêang quay‚Ä¶";
      tiles[i].querySelector(".idx").textContent = "‚Äî";
    }
    document.getElementById("resultBox").style.display = "none";
  }

  function showTiles(picked){
    const tiles = document.getElementById("tiles").children;
    for(let i=0;i<3;i++){
      tiles[i].classList.remove("spinning");
      tiles[i].classList.add("locked");
      tiles[i].querySelector(".name").textContent = picked[i].name;
      tiles[i].querySelector(".idx").textContent = "#" + picked[i].index;
    }
  }

  function showResult(total, outcome, win, payout){
    document.getElementById("sumText").textContent = total;
    document.getElementById("outcomeBadge").textContent = parityText(outcome);
    const winText = document.getElementById("winText");
    winText.textContent = win
      ? ((outcome==="zero") ? "üéâ Tr√∫ng l·ªõn! Th∆∞·ªüng x2" : "üéâ Tr√∫ng th∆∞·ªüng")
      : "Ch∆∞a tr√∫ng";
    document.getElementById("resultBox").style.display = "block";
  }

  function spin(){
    if(state.spinning) return;

    const st = Math.max(0, Math.floor(Number(document.getElementById("stakeInput").value) || 0));
    state.stake = st;

    if(!state.bet){
      alert("Vui l√≤ng ch·ªçn c·ª≠a Ch·∫µn / L·∫ª / 0 tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu.");
      return;
    }
    if(st <= 0){
      alert("Ti·ªÅn c∆∞·ª£c ph·∫£i > 0.");
      return;
    }
    if(st > state.balance){
      alert("S·ªë d∆∞ kh√¥ng ƒë·ªß ƒë·ªÉ ƒë·∫∑t c∆∞·ª£c.");
      return;
    }
    if(state.employees.length < 3){
      alert("Danh s√°ch nh√¢n vi√™n ph·∫£i c√≥ √≠t nh·∫•t 3 ng∆∞·ªùi.");
      return;
    }

    state.spinning = true;
    save(); render();
    showSpinning();

    // iOS ·ªïn ƒë·ªãnh h∆°n
    document.getElementById("drumAudio").load();
    document.getElementById("fireAudio").load();

    playAudio("drumAudio");
    
    const TICK_MS = 140;     // t·ªëc ƒë·ªô nh·∫£y t√™n
    const LOCK1 = 6600;      // th·ªùi ƒëi·ªÉm ch·ªët √¥ 1
    const LOCK2 = 10600;      // th·ªùi ƒëi·ªÉm ch·ªët √¥ 2
    const LOCK3 = 20600;      // th·ªùi ƒëi·ªÉm ch·ªët √¥ 3 (k√®m t√≠nh k·∫øt qu·∫£)

    // Ch·ªçn k·∫øt qu·∫£ th·∫≠t (ƒë·ªÉ cu·ªëi c√πng ch·ªët ƒë√∫ng)
    const finalPicked = pickThreeUnique(state.employees);
    const tiles = document.getElementById("tiles").children;

    const randomDisplay = () => {
      const i = Math.floor(Math.random() * state.employees.length);
      return { name: state.employees[i], index: i + 1 };
    };

    const startTicker = (tileEl) => {
      return setInterval(() => {
        const r = randomDisplay();
        tileEl.querySelector(".name").textContent = r.name;
        tileEl.querySelector(".idx").textContent = "#" + r.index;
      }, TICK_MS);
    };

    const tick1 = startTicker(tiles[0]);
    const tick2 = startTicker(tiles[1]);
    const tick3 = startTicker(tiles[2]);

    // ch·ªët l·∫ßn l∆∞·ª£t 1-2-3
    setTimeout(() => {
      clearInterval(tick1);
      tiles[0].classList.remove("spinning");
      tiles[0].classList.add("locked");
      tiles[0].querySelector(".name").textContent = finalPicked[0].name;
      tiles[0].querySelector(".idx").textContent = "#" + finalPicked[0].index;
    }, LOCK1);

    setTimeout(() => {
      clearInterval(tick2);
      tiles[1].classList.remove("spinning");
      tiles[1].classList.add("locked");
      tiles[1].querySelector(".name").textContent = finalPicked[1].name;
      tiles[1].querySelector(".idx").textContent = "#" + finalPicked[1].index;
    }, LOCK2);

    setTimeout(() => {
      clearInterval(tick3);
      tiles[2].classList.remove("spinning");
      tiles[2].classList.add("locked");
      tiles[2].querySelector(".name").textContent = finalPicked[2].name;
      tiles[2].querySelector(".idx").textContent = "#" + finalPicked[2].index;

      // T√≠nh k·∫øt qu·∫£ sau khi ch·ªët xong
      const total = finalPicked.reduce((s,p)=>s+p.index, 0);
      const outcome = classify(total);

      // tr·ª´ c∆∞·ª£c tr∆∞·ªõc
      let balanceAfterBet = state.balance - st;

      const win = (state.bet === outcome);
      let payout = 0;
      if(win){
        payout = (outcome === "zero") ? (2*st) : st;
        balanceAfterBet += payout;
        playAudio("fireAudio");
      }

      state.balance = Math.max(0, balanceAfterBet);

      state.history.unshift({
        ts: nowVN(),
        bet: state.bet,
        stake: st,
        picked: finalPicked,
        total,
        outcome,
        win,
        payout
      });
      state.history = state.history.slice(0, 30);

      showResult(total, outcome, win, payout);

      state.spinning = false;
      save(); render();
    }, LOCK3);
  }

  function resetAll(){
    if(!confirm("Reset to√†n b·ªô (s·ªë d∆∞, l·ªãch s·ª≠, c∆∞·ª£c)?")) return;
    state.balance = 1000000;
    state.stake = 50000;
    state.bet = "";
    state.history = [];
    state.spinning = false;
    save(); render();

    const tiles = document.getElementById("tiles").children;
    for(let i=0;i<3;i++){
      tiles[i].classList.remove("spinning","locked");
      tiles[i].querySelector(".name").textContent = "‚Äî";
      tiles[i].querySelector(".idx").textContent = "‚Äî";
    }
    document.getElementById("resultBox").style.display = "none";
  }

  // Init
  load();
  render();
</script>
</body>
</html>
